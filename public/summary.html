<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diet Planner - Complete Meal Calendar</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Calendar Container */
        
        .calendar-container {
            background: #ffffff;
            padding: 20px;
            margin: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .calendar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 15px 0;
        }
        
        .view-toggle {
            display: flex;
            gap: 0;
        }
        
        .view-btn {
            padding: 8px 20px;
            border: none;
            background: #f0f0f0;
            color: #666;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            border-radius: 0;
        }
        
        .view-btn:first-child {
            border-radius: 8px 0 0 8px;
        }
        
        .view-btn:last-child {
            border-radius: 0 8px 8px 0;
        }
        
        .view-btn.active {
            background: #4caf50;
            color: white;
        }
        
        .nav-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .nav-btn {
            background: none;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 18px;
            color: #666;
            transition: all 0.2s ease;
        }
        
        .nav-btn:hover {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
        }
        
        .current-date {
            font-size: 24px;
            font-weight: bold;
            color: #2e7d32;
            margin: 0 20px;
        }
        
        .regenerate-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .regenerate-btn:hover {
            background: #45a049;
        }
        /* Summary Section */
        
        .summary-container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        .user-summary {
            background: #ffffff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .summary-title {
            text-align: center;
            color: #2e7d32;
            margin-bottom: 25px;
            font-size: 28px;
        }
        
        .user-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .info-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e8f5e9;
        }
        
        .info-value {
            font-size: 24px;
            font-weight: bold;
            color: #2e7d32;
            display: block;
        }
        
        .info-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        /* View Layouts */
        
        .day-view {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            margin: 20px;
        }
        
        .week-view {
            display: flex;
            flex-direction: column;
            margin: 20px;
        }
        
        .hidden {
            display: none !important;
        }
        /* Day View - Meals Left */
        
        .meals-container {
            background: #ffffff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .date-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            font-size: 16px;
            color: #666;
        }
        
        .calories-badge {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .meal-sections {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .meal-section {
            background: #f9fff7;
            border: 1px solid #c8e6c9;
            border-radius: 12px;
            padding: 20px;
            transition: transform 0.2s ease;
        }
        
        .meal-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.15);
        }
        
        .meal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .meal-title {
            font-size: 18px;
            font-weight: bold;
            color: #2e7d32;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .meal-calories {
            background: #4caf50;
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .meal-refresh {
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            opacity: 0.7;
            transition: all 0.2s ease;
        }
        
        .meal-refresh:hover {
            opacity: 1;
            background: rgba(0, 0, 0, 0.05);
        }
        
        .meal-items {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .meal-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .meal-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #4caf50, #8bc34a);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }
        
        .meal-info {
            flex: 1;
        }
        
        .meal-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }
        
        .meal-details {
            font-size: 12px;
            color: #666;
        }
        /* Day View - Pie Chart Right */
        
        .nutrition-panel {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 20px;
            height: fit-content;
        }
        
        .nutrition-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .nutrition-title {
            font-size: 20px;
            font-weight: bold;
            color: #2e7d32;
        }
        
        .nutrition-chart {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: conic-gradient( from 0deg, #4caf50 0deg 180deg, #2196f3 180deg 252deg, #ff9800 252deg 324deg, #e0e0e0 324deg 360deg);
            margin: 20px auto;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .chart-center {
            width: 120px;
            height: 120px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            font-weight: bold;
            color: #2e7d32;
        }
        
        .nutrition-stats {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }
        
        .nutrition-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .nutrition-label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
            color: #333;
        }
        
        .nutrition-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .nutrition-values {
            text-align: right;
            font-size: 14px;
        }
        
        .actual-value {
            font-weight: bold;
            color: #2e7d32;
        }
        /* Week View - List Layout */
        
        .week-container {
            background: #ffffff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .week-title {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: #2e7d32;
            margin-bottom: 25px;
        }
        
        .days-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .day-card {
            background: #f9fff7;
            border: 1px solid #c8e6c9;
            border-radius: 12px;
            padding: 20px;
            transition: transform 0.2s ease;
        }
        
        .day-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.15);
        }
        
        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .day-name {
            font-size: 18px;
            font-weight: bold;
            color: #2e7d32;
        }
        
        .day-calories {
            background: #4caf50;
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .day-meals {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .quick-meal {
            font-size: 14px;
            color: #555;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .quick-meal:last-child {
            border-bottom: none;
        }
        /* Loading and Messages */
        
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: #666;
        }
        
        .loading:before {
            content: "";
            width: 20px;
            height: 20px;
            border: 2px solid #4caf50;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        
        .success-message {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin: 15px 0;
        }
        
        .error-message {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin: 20px 0;
        }
        /* Action Buttons */
        
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .action-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .action-btn:hover {
            background: #45a049;
        }
        /* Responsive Design */
        
        @media (max-width: 768px) {
            .day-view {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            .nutrition-panel {
                position: static;
            }
            .days-grid {
                grid-template-columns: 1fr;
            }
            .calendar-header {
                flex-direction: column;
                gap: 15px;
            }
            .user-info {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>

<body>
    <header>
        <div class="logo-title">
            <img src="image/logo.png" alt="Logo">
            <h1>Diet Planner</h1>
        </div>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="summary.html">Summary</a></li>
                <li><a href="healthtracker.html">Health Tracker</a></li>
                <li><a href="chatbot.html">Chat Bot</a></li>
                <li><a href="landing.html">Logout</a></li>
            </ul>
        </nav>
    </header>

    <!-- User Summary Section Always Visible -->
    <div class="summary-container">
        <h2 class="summary-title">Your Diet Summary</h2>
        <div class="user-summary">
            <div class="user-info">
                <div class="info-card">
                    <span class="info-value" id="bmiValue">--</span>
                    <div class="info-label">BMI</div>
                </div>
                <div class="info-card">
                    <span class="info-value" id="currentWeight">--</span>
                    <div class="info-label">Current Weight (kg)</div>
                </div>
                <div class="info-card">
                    <span class="info-value" id="goalWeight">--</span>
                    <div class="info-label">Goal Weight (kg)</div>
                </div>
                <div class="info-card">
                    <span class="info-value" id="dietType">--</span>
                    <div class="info-label">Diet Type</div>
                </div>
                <div class="info-card">
                    <span class="info-value" id="calorieLimit">--</span>
                    <div class="info-label">Daily Calories</div>
                </div>
            </div>
            <div id="statusMessage"></div>
        </div>
    </div>

    <!-- Calendar Header -->
    <div class="calendar-container">
        <div class="calendar-header">
            <div class="view-toggle">
                <button class="view-btn active" onclick="setView('day')" id="dayBtn">Day</button>
                <button class="view-btn" onclick="setView('week')" id="weekBtn">Week</button>
            </div>
            <div class="nav-controls">
                <button class="nav-btn" onclick="navigateDate(-1)">◀</button>
                <span class="current-date" id="currentDate">Today</span>
                <button class="nav-btn" onclick="navigateDate(1)">▶</button>
            </div>
            <button class="regenerate-btn" onclick="regenerateMeals()">
                <span id="regenerateText">Generate New Plan</span>
            </button>
        </div>

        <!-- Day View: Meals Left, Chart Right -->
        <div class="day-view" id="dayView">
            <div class="meals-container">
                <div class="date-info">
                    <span id="selectedDate">September 24</span>
                    <span id="selectedDay">Today</span>
                </div>
                <div class="calories-badge">
                    <span>🔥</span>
                    <span id="dailyCalories">Loading...</span>
                </div>
                <div class="meal-sections" id="mealSections">
                    <div class="loading">Loading your meal plan...</div>
                </div>
            </div>

            <!-- Nutrition Chart -->
            <div class="nutrition-panel">
                <div class="nutrition-header">
                    <h3 class="nutrition-title">Daily Nutrition</h3>
                </div>

                <div class="nutrition-chart">
                    <div class="chart-center">
                        <div style="font-size: 12px;">Total</div>
                        <div style="font-size: 16px;" id="chartCalories">0 kcal</div>
                    </div>
                </div>

                <div class="nutrition-stats" id="nutritionStats">
                    <div class="nutrition-row">
                        <div class="nutrition-label">
                            <div class="nutrition-indicator" style="background: #4caf50;"></div>
                            <span>Carbs</span>
                        </div>
                        <div class="nutrition-values">
                            <div class="actual-value" id="carbsValue">0g</div>
                        </div>
                    </div>

                    <div class="nutrition-row">
                        <div class="nutrition-label">
                            <div class="nutrition-indicator" style="background: #2196f3;"></div>
                            <span>Fat</span>
                        </div>
                        <div class="nutrition-values">
                            <div class="actual-value" id="fatValue">0g</div>
                        </div>
                    </div>

                    <div class="nutrition-row">
                        <div class="nutrition-label">
                            <div class="nutrition-indicator" style="background: #ff9800;"></div>
                            <span>Protein</span>
                        </div>
                        <div class="nutrition-values">
                            <div class="actual-value" id="proteinValue">0g</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Week View: Meal List -->
        <div class="week-view hidden" id="weekView">
            <div class="week-container">
                <h2 class="week-title">Weekly Meal Plan</h2>
                <div class="days-grid" id="daysGrid">
                    <div class="loading">Loading weekly meal plan...</div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>Follow us: <a href="#">Facebook</a> | <a href="#">Instagram</a> | <a href="#">Twitter</a></p>
        <p>Contact: dietplanner@example.com</p>
    </footer>

    <script>
        // Constants
        const API_BASE = 'http://localhost:3000';

        // Global variables
        let currentView = 'day';
        let currentDate = new Date();
        let userDiet = 'Vegan';
        let calorieTarget = 1600;
        let currentMealPlan = null;

        // Initialize page
        document.addEventListener('DOMContentLoaded', async function() {
            await loadUserData();
            updateDateDisplay();

            // Check if user came from home page "Generate Plan" button
            const shouldGeneratePlan = localStorage.getItem('generatePlan') === 'true';
            if (shouldGeneratePlan) {
                localStorage.removeItem('generatePlan'); // Clear flag
                // Auto-generate AI meal plan
                setTimeout(() => {
                    regenerateMeals();
                }, 1000);
            } else {
                loadMealPlan();
            }
        });

        // Load user data (backend first, then local fallback)
        async function loadUserData() {
            const token = localStorage.getItem('authToken');
            let populated = false;

            if (token) {
                try {
                    const res = await fetch(`${API_BASE}/api/user-preferences`, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    if (res.ok) {
                        const data = await res.json();
                        const prefs = (data && data.preferences) || {};


                        if (Object.keys(prefs).length > 0) {
                            populateSummary(prefs);
                            populated = true;
                            showMessage("Loaded preferences from server.", "success");
                        }
                    }
                } catch (e) {
                    console.warn("Backend not reachable, falling back to localStorage");
                }
            }

            if (!populated) {
                // Fallback to localStorage
                const data = {
                    bmi: localStorage.getItem('bmi'),
                    weight: localStorage.getItem('weight'),
                    goalWeight: localStorage.getItem('goal'),
                    dietType: localStorage.getItem('diet'),
                    calorieLimit: localStorage.getItem('calorieLimit'),
                };

                populateSummary(data);
                showMessage("Showing saved local data.", "warning");
            }
        }

        function populateSummary(prefs) {
            document.getElementById('bmiValue').innerText = prefs.bmi || '--';
            document.getElementById('currentWeight').innerText = prefs.weight || '--';
            document.getElementById('goalWeight').innerText = prefs.goalWeight || '--';
            document.getElementById('dietType').innerText = prefs.dietType || '--';
            document.getElementById('calorieLimit').innerText = prefs.calorieLimit || prefs.calorieTarget || '--';

            // Update global variables
            userDiet = prefs.dietType || 'Vegan';
            calorieTarget = parseInt(prefs.calorieLimit || prefs.calorieTarget) || 1600;

            // Update the nutrition chart after populating data
            setTimeout(() => updateNutritionChart(), 100);
        }

        function showMessage(msg, type) {
            const status = document.getElementById('statusMessage');
            if (type === 'success') {
                status.innerHTML = `<div class="success-message">${msg}</div>`;
            } else {
                status.innerHTML = `<div class="error-message">${msg}</div>`;
            }

            // Auto hide after 4 seconds
            setTimeout(() => {
                status.innerHTML = '';
            }, 4000);
        }

        // Update nutrition chart with user's actual calories
        function updateNutritionChart(plan) {
            // Get the user's actual calorie target
            const userCalories = calorieTarget || parseInt(document.getElementById('calorieLimit').textContent) || 1600;

            // Update the chart center with user's calories
            document.getElementById('chartCalories').textContent = userCalories + ' kcal';

            // Calculate nutrition breakdown based on user's calories
            const carbsPercentage = 50; // 50% of calories from carbs
            const fatPercentage = 30; // 30% of calories from fat  
            const proteinPercentage = 20; // 20% of calories from protein

            // Calculate grams (4 kcal per g carbs/protein, 9 kcal per g fat)
            const carbsGrams = Math.round((userCalories * carbsPercentage / 100) / 4);
            const fatGrams = Math.round((userCalories * fatPercentage / 100) / 9);
            const proteinGrams = Math.round((userCalories * proteinPercentage / 100) / 4);

            // Update the nutrition stats
            document.getElementById('carbsValue').textContent = carbsGrams + 'g';
            document.getElementById('fatValue').textContent = fatGrams + 'g';
            document.getElementById('proteinValue').textContent = proteinGrams + 'g';

            // Update the pie chart visual
            updatePieChartVisual(carbsPercentage, fatPercentage, proteinPercentage);
        }

        function updatePieChartVisual(carbsPercent, fatPercent, proteinPercent) {
            // Calculate degrees for each segment
            const carbsDegrees = (carbsPercent / 100) * 360;
            const fatDegrees = (fatPercent / 100) * 360;
            const proteinDegrees = (proteinPercent / 100) * 360;

            // Update the pie chart using CSS conic-gradient
            const chartElement = document.querySelector('.nutrition-chart');
            if (chartElement) {
                const gradient = `conic-gradient(
                    from 0deg,
                    #4caf50 0deg ${carbsDegrees}deg,
                    #2196f3 ${carbsDegrees}deg ${carbsDegrees + fatDegrees}deg,
                    #ff9800 ${carbsDegrees + fatDegrees}deg ${carbsDegrees + fatDegrees + proteinDegrees}deg,
                    #e0e0e0 ${carbsDegrees + fatDegrees + proteinDegrees}deg 360deg
                )`;

                chartElement.style.background = gradient;
            }
        }

        // Sample meal data with more variety
        const mealDatabase = {
            'Vegan': {
                breakfast: [{
                    name: 'Quinoa Breakfast Bowl',
                    calories: 320,
                    icon: '🥣',
                    carbs: 58,
                    fat: 6,
                    protein: 12
                }, {
                    name: 'Avocado Toast with Hemp Seeds',
                    calories: 280,
                    icon: '🥑',
                    carbs: 32,
                    fat: 18,
                    protein: 8
                }, {
                    name: 'Chia Pudding with Mango',
                    calories: 250,
                    icon: '🥭',
                    carbs: 35,
                    fat: 12,
                    protein: 6
                }, {
                    name: 'Green Smoothie Bowl',
                    calories: 290,
                    icon: '🥬',
                    carbs: 45,
                    fat: 8,
                    protein: 10
                }, {
                    name: 'Oatmeal with Berries',
                    calories: 270,
                    icon: '🫐',
                    carbs: 50,
                    fat: 5,
                    protein: 8
                }],
                lunch: [{
                    name: 'Mediterranean Chickpea Salad',
                    calories: 380,
                    icon: '🥗',
                    carbs: 45,
                    fat: 16,
                    protein: 15
                }, {
                    name: 'Buddha Bowl with Tofu',
                    calories: 420,
                    icon: '🥗',
                    carbs: 52,
                    fat: 15,
                    protein: 18
                }, {
                    name: 'Lentil Curry with Rice',
                    calories: 390,
                    icon: '🍛',
                    carbs: 65,
                    fat: 8,
                    protein: 16
                }, {
                    name: 'Quinoa Stuffed Peppers',
                    calories: 350,
                    icon: '🌶️',
                    carbs: 48,
                    fat: 12,
                    protein: 14
                }, {
                    name: 'Black Bean Tacos',
                    calories: 330,
                    icon: '🌮',
                    carbs: 45,
                    fat: 10,
                    protein: 12
                }],
                dinner: [{
                    name: 'Stuffed Bell Peppers',
                    calories: 350,
                    icon: '🫑',
                    carbs: 48,
                    fat: 14,
                    protein: 12
                }, {
                    name: 'Mushroom Walnut Pasta',
                    calories: 420,
                    icon: '🍝',
                    carbs: 55,
                    fat: 18,
                    protein: 14
                }, {
                    name: 'Eggplant Stir Fry',
                    calories: 310,
                    icon: '🍆',
                    carbs: 35,
                    fat: 16,
                    protein: 8
                }, {
                    name: 'Sweet Potato Curry',
                    calories: 340,
                    icon: '🍠',
                    carbs: 55,
                    fat: 12,
                    protein: 10
                }],
                snacks: [{
                    name: 'Hummus with Veggie Sticks',
                    calories: 150,
                    icon: '🥒',
                    carbs: 18,
                    fat: 8,
                    protein: 6
                }, {
                    name: 'Energy Balls',
                    calories: 180,
                    icon: '⚽',
                    carbs: 22,
                    fat: 9,
                    protein: 5
                }, {
                    name: 'Almond Butter Toast',
                    calories: 220,
                    icon: '🥜',
                    carbs: 20,
                    fat: 14,
                    protein: 8
                }]
            },
            'Non-Veg': {
                breakfast: [{
                    name: 'Scrambled Eggs with Salmon',
                    calories: 350,
                    icon: '🍳',
                    carbs: 8,
                    fat: 24,
                    protein: 28
                }, {
                    name: 'Greek Yogurt Parfait',
                    calories: 280,
                    icon: '🥛',
                    carbs: 35,
                    fat: 8,
                    protein: 20
                }, {
                    name: 'Chicken Sausage Omelet',
                    calories: 320,
                    icon: '🍳',
                    carbs: 6,
                    fat: 22,
                    protein: 25
                }, {
                    name: 'Protein Pancakes',
                    calories: 300,
                    icon: '🥞',
                    carbs: 25,
                    fat: 12,
                    protein: 24
                }],
                lunch: [{
                    name: 'Grilled Chicken Caesar Salad',
                    calories: 420,
                    icon: '🥗',
                    carbs: 18,
                    fat: 25,
                    protein: 35
                }, {
                    name: 'Salmon Bowl with Quinoa',
                    calories: 480,
                    icon: '🐟',
                    carbs: 45,
                    fat: 20,
                    protein: 32
                }, {
                    name: 'Turkey and Avocado Wrap',
                    calories: 380,
                    icon: '🌯',
                    carbs: 32,
                    fat: 16,
                    protein: 28
                }, {
                    name: 'Tuna Salad Bowl',
                    calories: 360,
                    icon: '🐟',
                    carbs: 25,
                    fat: 18,
                    protein: 30
                }],
                dinner: [{
                    name: 'Grilled Steak with Sweet Potato',
                    calories: 520,
                    icon: '🥩',
                    carbs: 35,
                    fat: 26,
                    protein: 38
                }, {
                    name: 'Baked Cod with Vegetables',
                    calories: 320,
                    icon: '🐟',
                    carbs: 25,
                    fat: 12,
                    protein: 28
                }, {
                    name: 'Chicken Stir Fry',
                    calories: 380,
                    icon: '🍗',
                    carbs: 30,
                    fat: 16,
                    protein: 32
                }],
                snacks: [{
                    name: 'Hard Boiled Eggs',
                    calories: 140,
                    icon: '🥚',
                    carbs: 2,
                    fat: 10,
                    protein: 12
                }, {
                    name: 'Tuna Salad Crackers',
                    calories: 220,
                    icon: '🐟',
                    carbs: 15,
                    fat: 12,
                    protein: 18
                }, {
                    name: 'Protein Smoothie',
                    calories: 200,
                    icon: '🥤',
                    carbs: 18,
                    fat: 8,
                    protein: 20
                }]
            },
            'Vegetarian': {
                breakfast: [{
                    name: 'Veggie Scrambled Eggs',
                    calories: 290,
                    icon: '🍳',
                    carbs: 12,
                    fat: 20,
                    protein: 18
                }, {
                    name: 'Pancakes with Greek Yogurt',
                    calories: 340,
                    icon: '🥞',
                    carbs: 48,
                    fat: 10,
                    protein: 16
                }],
                lunch: [{
                    name: 'Caprese Salad with Mozzarella',
                    calories: 320,
                    icon: '🍅',
                    carbs: 12,
                    fat: 24,
                    protein: 18
                }, {
                    name: 'Vegetarian Quesadilla',
                    calories: 420,
                    icon: '🧀',
                    carbs: 45,
                    fat: 18,
                    protein: 20
                }],
                dinner: [{
                    name: 'Eggplant Parmesan',
                    calories: 380,
                    icon: '🍆',
                    carbs: 35,
                    fat: 22,
                    protein: 16
                }],
                snacks: [{
                    name: 'Cheese and Crackers',
                    calories: 180,
                    icon: '🧀',
                    carbs: 18,
                    fat: 10,
                    protein: 8
                }]
            },
            'Keto': {
                breakfast: [{
                    name: 'Keto Avocado Eggs',
                    calories: 380,
                    icon: '🥑',
                    carbs: 8,
                    fat: 34,
                    protein: 16
                }, {
                    name: 'Coconut Chia Pudding',
                    calories: 320,
                    icon: '🥥',
                    carbs: 12,
                    fat: 28,
                    protein: 8
                }],
                lunch: [{
                    name: 'Keto Caesar Salad',
                    calories: 420,
                    icon: '🥗',
                    carbs: 8,
                    fat: 34,
                    protein: 25
                }],
                dinner: [{
                    name: 'Keto Salmon with Asparagus',
                    calories: 450,
                    icon: '🐟',
                    carbs: 6,
                    fat: 35,
                    protein: 32
                }],
                snacks: [{
                    name: 'Keto Fat Bombs',
                    calories: 200,
                    icon: '🥜',
                    carbs: 3,
                    fat: 20,
                    protein: 4
                }]
            },
            'Gluten-Free': {
                breakfast: [{
                    name: 'Quinoa Breakfast Porridge',
                    calories: 310,
                    icon: '🥣',
                    carbs: 52,
                    fat: 8,
                    protein: 12
                }],
                lunch: [{
                    name: 'Rice Bowl with Vegetables',
                    calories: 350,
                    icon: '🍚',
                    carbs: 65,
                    fat: 8,
                    protein: 10
                }],
                dinner: [{
                    name: 'Zucchini Noodles with Pesto',
                    calories: 280,
                    icon: '🥒',
                    carbs: 18,
                    fat: 22,
                    protein: 8
                }],
                snacks: [{
                    name: 'Rice Cakes with Almond Butter',
                    calories: 160,
                    icon: '🍘',
                    carbs: 18,
                    fat: 8,
                    protein: 6
                }]
            }
        };

        // View switching
        async function setView(view) {
            currentView = view;

            // Update button states
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(view === 'day' ? 'dayBtn' : 'weekBtn').classList.add('active');

            // Show/hide views
            document.getElementById('dayView').classList.toggle('hidden', view !== 'day');
            document.getElementById('weekView').classList.toggle('hidden', view !== 'week');

            // Update current date text and regenerate button
            if (view === 'day') {
                document.getElementById('currentDate').textContent = 'Today';
                document.getElementById('regenerateText').textContent = 'Generate New Plan';
            } else {
                document.getElementById('currentDate').textContent = 'This Week';
                document.getElementById('regenerateText').textContent = 'Generate Week';
            }

            // Load meal plan
            await loadMealPlan();
        }

        // Date navigation
        async function navigateDate(direction) {
            if (currentView === 'day') {
                currentDate.setDate(currentDate.getDate() + direction);
            } else {
                currentDate.setDate(currentDate.getDate() + (direction * 7));
            }
            updateDateDisplay();
            await loadMealPlan();
        }

        function updateDateDisplay() {
            const options = {
                month: 'long',
                day: 'numeric'
            };
            document.getElementById('selectedDate').textContent = currentDate.toLocaleDateString('en-US', options);

            const today = new Date();
            const isToday = currentDate.toDateString() === today.toDateString();
            document.getElementById('selectedDay').textContent = isToday ? 'Today' : currentDate.toLocaleDateString('en-US', {
                weekday: 'long'
            });
        }

        // Load meal plan
        async function loadMealPlan() {
            if (currentView === 'day') {
                await loadDayMealPlan();
            } else {
                await loadWeekMealPlan();
            }
        }

        // Load daily meal plan (uses backend AI route with a graceful fallback)
        async function loadDayMealPlan() {
            const container = document.getElementById('mealSections');
            container.innerHTML = '<div class="loading">Loading meal plan...</div>';

            try {
                // Pull inputs from summary cards or stored globals
                const bmi = parseFloat((document.getElementById('bmiValue').textContent || '').replace(/[^0-9.]/g, '')) || null;
                const goalWeight = parseFloat((document.getElementById('goalWeight').textContent || '').replace(/[^0-9.]/g, '')) || null;
                const dietPreference = (document.getElementById('dietType').textContent || userDiet || 'Vegan').trim();
                const calorieLimitText = document.getElementById('calorieLimit').textContent || '';
                const calorieLimit = parseInt(calorieLimitText.replace(/[^0-9]/g, ''), 10) || calorieTarget || 1600;

                const resp = await fetch(`${API_BASE}/ai-meal-plan`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        bmi,
                        goalWeight,
                        dietPreference,
                        calorieLimit
                    })
                });

                if (!resp.ok) throw new Error('Failed to fetch AI meal plan');
                const data = await resp.json();
                const plan = (data && data.plan) || {};

                if (!plan || !plan.breakfast || !plan.lunch || !plan.dinner || !Array.isArray(plan.snacks)) {
                    throw new Error('Malformed AI plan, using fallback');
                }

                // Map AI shape to existing UI shape (add basic icon + macros placeholder)
                const withIcons = aiPlanToUiPlan(plan);
                currentMealPlan = withIcons;
                displayDayMealPlan(withIcons);
                updateNutritionChart(withIcons);
                showSuccessMessage(`🤖 AI-generated ${dietPreference} meal plan created!`);
            } catch (e) {
                console.warn('AI plan failed; falling back to local generator:', e.message || e);
                const dailyPlan = generateDailyMealPlan(userDiet);
                currentMealPlan = dailyPlan;
                displayDayMealPlan(dailyPlan);
                updateNutritionChart(dailyPlan);

            }
        }

        // Generate random daily meal plan (local fallback)
        function generateDailyMealPlan(dietType) {
            const meals = mealDatabase[dietType] || mealDatabase['Vegan'];

            const breakfast = meals.breakfast[Math.floor(Math.random() * meals.breakfast.length)];
            const lunch = meals.lunch[Math.floor(Math.random() * meals.lunch.length)];
            const dinner = meals.dinner[Math.floor(Math.random() * meals.dinner.length)];
            const snack = meals.snacks[Math.floor(Math.random() * meals.snacks.length)];

            const totalCalories = breakfast.calories + lunch.calories + dinner.calories + snack.calories;

            return {
                breakfast,
                lunch,
                dinner,
                snacks: [snack],
                totalCalories,
                totalCarbs: breakfast.carbs + lunch.carbs + dinner.carbs + snack.carbs,
                totalFat: breakfast.fat + lunch.fat + dinner.fat + snack.fat,
                totalProtein: breakfast.protein + lunch.protein + dinner.protein + snack.protein
            };
        }
        // Helper function to get meal icon based on name and meal type
        function getMealIcon(name, mealType) {
            const iconMap = [{
                key: 'oat|porridge|chia|quinoa|cereal|bowl',
                icon: '🥣'
            }, {
                key: 'egg|omelet|scramble',
                icon: '🍳'
            }, {
                key: 'salad|greens|bowl',
                icon: '🥗'
            }, {
                key: 'fish|salmon|tuna|cod',
                icon: '🐟'
            }, {
                key: 'chicken|turkey',
                icon: '🍗'
            }, {
                key: 'pasta|noodle',
                icon: '🍝'
            }, {
                key: 'rice',
                icon: '🍚'
            }, {
                key: 'fruit|apple|banana|berries',
                icon: '🍎'
            }, {
                key: 'soup|broth',
                icon: '🍲'
            }, {
                key: 'sandwich|wrap|burrito',
                icon: '🌯'
            }, {
                key: 'pizza|flatbread',
                icon: '🍕'
            }, {
                key: 'burger|patty',
                icon: '🍔'
            }, {
                key: 'smoothie|shake|drink',
                icon: '🥤'
            }, {
                key: 'nuts|almond|walnut|peanut',
                icon: '🥜'
            }, {
                key: 'cheese|dairy',
                icon: '🧀'
            }, {
                key: 'bread|toast|bagel',
                icon: '🍞'
            }, {
                key: 'pancake|waffle',
                icon: '🥞'
            }, {
                key: 'yogurt|parfait',
                icon: '🥛'
            }];

            const lower = (name || '').toLowerCase();
            for (const m of iconMap) {
                if (new RegExp(m.key).test(lower)) return m.icon;
            }

            // Default icons by meal type
            const defaults = {
                breakfast: '🌅',
                lunch: '🌞',
                dinner: '🌙',
                snacks: '🍎'
            };
            return defaults[mealType] || '🍽️';
        }

        // Convert minimal AI plan to the UI structure with icons and macro placeholders
        function aiPlanToUiPlan(ai) {
            // Provide simple macros so existing UI renders nicely
            const mk = (m, fallbackIcon) => ({
                name: m.name,
                calories: parseInt(m.calories, 10) || 0,
                icon: getMealIcon(m.name, ''),
                carbs: 0,
                fat: 0,
                protein: 0
            });

            const breakfast = mk(ai.breakfast || {
                name: 'Breakfast',
                calories: 0
            }, '🌅');
            const lunch = mk(ai.lunch || {
                name: 'Lunch',
                calories: 0
            }, '🌞');
            const dinner = mk(ai.dinner || {
                name: 'Dinner',
                calories: 0
            }, '🌙');
            const snacks = Array.isArray(ai.snacks) && ai.snacks.length ? ai.snacks.map(s => mk(s, '🍎')) : [mk({
                name: 'Snack',
                calories: 0
            }, '🍎')];

            const totalCalories = [breakfast, lunch, dinner, ...snacks].reduce((s, x) => s + (x.calories || 0), 0);
            return {
                breakfast,
                lunch,
                dinner,
                snacks,
                totalCalories,
                totalCarbs: 0,
                totalFat: 0,
                totalProtein: 0
            };
        }

        // Display daily meal plan
        function displayDayMealPlan(plan) {
            document.getElementById('dailyCalories').textContent = `${plan.totalCalories} Calories`;

            const mealSections = document.getElementById('mealSections');
            mealSections.innerHTML = `
                ${renderMealSection('🌅', 'Breakfast', plan.breakfast, 'breakfast')}
                ${renderMealSection('🌞', 'Lunch', plan.lunch, 'lunch')}
                ${renderMealSection('🌙', 'Dinner', plan.dinner, 'dinner')}
                ${renderMealSection('🍎', 'Snacks', plan.snacks, 'snacks')}
            `;

            showSuccessMessage(`New ${userDiet} meal plan generated for ${document.getElementById('selectedDay').textContent}!`);
        }

        // Render meal section
        function renderMealSection(emoji, title, meals, mealType) {
            const mealArray = Array.isArray(meals) ? meals : [meals];
            const totalCalories = mealArray.reduce((sum, meal) => sum + meal.calories, 0);

            return `
                <div class="meal-section">
                    <div class="meal-header">
                        <div class="meal-title">
                            <span>${emoji}</span>
                            <span>${title}</span>
                        </div>
                        <div class="meal-calories">${totalCalories} kcal</div>
                        <button class="meal-refresh" onclick="refreshMealSection('${mealType}')" title="Refresh ${title}">🔄</button>
                    </div>
                    <div class="meal-items">
                        ${mealArray.map(meal => renderMealItem(meal)).join('')}
                    </div>
                </div>
            `;
        }

        // Render meal item
        function renderMealItem(meal) {
            return `
                <div class="meal-item">
                    <div class="meal-icon">${meal.icon}</div>
                    <div class="meal-info">
                        <div class="meal-name">${meal.name}</div>
                        <div class="meal-details">${meal.calories} kcal • ${meal.protein}g protein</div>
                    </div>
                </div>
            `;
        }

        // Load weekly meal plan with AI
        async function loadWeekMealPlan() {
            document.getElementById('daysGrid').innerHTML = '<div class="loading">🤖 Generating AI weekly meal plan...</div>';

            try {
                // Get current user data
                const bmi = parseFloat((document.getElementById('bmiValue').textContent || '').replace(/[^0-9.]/g, '')) || null;
                const goalWeight = parseFloat((document.getElementById('goalWeight').textContent || '').replace(/[^0-9.]/g, '')) || null;
                const dietPreference = (document.getElementById('dietType').textContent || userDiet || 'Vegan').trim();
                const calorieLimitText = document.getElementById('calorieLimit').textContent || '';
                const calorieLimit = parseInt(calorieLimitText.replace(/[^0-9]/g, ''), 10) || calorieTarget || 1600;

                // Generate 7 different AI meal plans for the week
                const weekPlan = {};
                const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];

                for (const day of days) {
                    try {
                        const resp = await fetch(`${API_BASE}/ai-meal-plan`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                bmi,
                                goalWeight,
                                dietPreference,
                                calorieLimit
                            })
                        });

                        if (resp.ok) {
                            const data = await resp.json();
                            const plan = (data && data.plan) || {};
                            if (plan && plan.breakfast && plan.lunch && plan.dinner && Array.isArray(plan.snacks)) {
                                weekPlan[day] = aiPlanToUiPlan(plan);
                            } else {
                                throw new Error('Invalid AI plan');
                            }
                        } else {
                            throw new Error('API failed');
                        }
                    } catch (e) {
                        // Fallback to local generation for this day
                        weekPlan[day] = generateDailyMealPlan(userDiet);
                    }
                }

                displayWeekMealPlan(weekPlan);
                showSuccessMessage(`🤖 AI-generated weekly ${dietPreference} meal plan created!`);
            } catch (e) {
                console.warn('AI weekly plan failed; using local fallback:', e.message || e);
                const weekPlan = generateWeeklyMealPlan(userDiet);
                displayWeekMealPlan(weekPlan);
                showMessage('AI unavailable. Showing local weekly plan.', 'warning');
            }
        }

        // Generate weekly meal plan
        function generateWeeklyMealPlan(dietType) {
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            const weekPlan = {};

            days.forEach(day => {
                weekPlan[day] = generateDailyMealPlan(dietType);
            });

            return weekPlan;
        }

        // Display weekly meal plan
        function displayWeekMealPlan(weekPlan) {
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            const daysGrid = document.getElementById('daysGrid');

            daysGrid.innerHTML = days.map(day => {
                const dayPlan = weekPlan[day];
                return `
                    <div class="day-card">
                        <div class="day-header">
                            <div class="day-name">${day}</div>
                            <div class="day-calories">${dayPlan.totalCalories} kcal</div>
                        </div>
                        <div class="day-meals">
                            <div class="quick-meal"><span>🌅</span> <span>${dayPlan.breakfast.name}</span></div>
                            <div class="quick-meal"><span>🌞</span> <span>${dayPlan.lunch.name}</span></div>
                            <div class="quick-meal"><span>🌙</span> <span>${dayPlan.dinner.name}</span></div>
                            <div class="quick-meal"><span>🍎</span> <span>${dayPlan.snacks[0].name}</span></div>
                        </div>
                    </div>
                `;
            }).join('');

            showSuccessMessage(`New weekly ${userDiet} meal plan generated!`);
        }

        // Regenerate meals
        async function regenerateMeals() {
            const button = document.querySelector('.regenerate-btn');
            const originalHTML = button.innerHTML;

            button.innerHTML = 'Generating AI Plan...';
            button.disabled = true;

            // Show loading message
            const container = currentView === 'day' ? document.getElementById('mealSections') : document.getElementById('daysGrid');
            container.innerHTML = '<div class="loading">🤖 Generating your personalized AI meal plan...</div>';

            try {
                await loadMealPlan();
            } catch (e) {
                console.warn('Regenerate failed:', e);
            } finally {
                button.innerHTML = originalHTML;
                button.disabled = false;
            }
        }

        // Refresh individual meal section with AI
        async function refreshMealSection(mealType) {
            try {
                // Get current user data
                const bmi = parseFloat((document.getElementById('bmiValue').textContent || '').replace(/[^0-9.]/g, '')) || null;
                const goalWeight = parseFloat((document.getElementById('goalWeight').textContent || '').replace(/[^0-9.]/g, '')) || null;
                const dietPreference = (document.getElementById('dietType').textContent || userDiet || 'Vegan').trim();
                const calorieLimitText = document.getElementById('calorieLimit').textContent || '';
                const calorieLimit = parseInt(calorieLimitText.replace(/[^0-9]/g, ''), 10) || calorieTarget || 1600;

                // Show loading state
                const mealSection = document.querySelector(`[onclick*="${mealType}"]`).closest('.meal-section');
                const originalContent = mealSection.innerHTML;
                mealSection.innerHTML = '<div class="loading">🤖 Generating new AI option...</div>';

                // Call AI API for new meal
                const resp = await fetch(`${API_BASE}/ai-meal-plan`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        bmi,
                        goalWeight,
                        dietPreference,
                        calorieLimit
                    })
                });

                if (!resp.ok) throw new Error('Failed to fetch AI meal');
                const data = await resp.json();
                const plan = (data && data.plan) || {};

                if (!plan || !plan.breakfast || !plan.lunch || !plan.dinner || !Array.isArray(plan.snacks)) {
                    throw new Error('Malformed AI plan');
                }

                // Get the specific meal type from AI response
                let newMeal;
                if (mealType === 'snacks') {
                    newMeal = plan.snacks[0] || {
                        name: 'AI Snack',
                        calories: 150
                    };
                } else {
                    newMeal = plan[mealType] || {
                        name: `AI ${mealType}`,
                        calories: 400
                    };
                }

                // Convert to UI format with icon
                const withIcon = {
                    name: newMeal.name,
                    calories: parseInt(newMeal.calories, 10) || 400,
                    icon: getMealIcon(newMeal.name, mealType),
                    carbs: 0,
                    fat: 0,
                    protein: 0
                };

                // Update current meal plan
                if (mealType === 'snacks') {
                    currentMealPlan.snacks = [withIcon];
                } else {
                    currentMealPlan[mealType] = withIcon;
                }

                // Recalculate totals
                const breakfast = currentMealPlan.breakfast;
                const lunch = currentMealPlan.lunch;
                const dinner = currentMealPlan.dinner;
                const snack = currentMealPlan.snacks[0];

                currentMealPlan.totalCalories = breakfast.calories + lunch.calories + dinner.calories + snack.calories;
                currentMealPlan.totalCarbs = breakfast.carbs + lunch.carbs + dinner.carbs + snack.carbs;
                currentMealPlan.totalFat = breakfast.fat + lunch.fat + dinner.fat + snack.fat;
                currentMealPlan.totalProtein = breakfast.protein + lunch.protein + dinner.protein + snack.protein;

                // Update display
                displayDayMealPlan(currentMealPlan);
                updateNutritionChart(currentMealPlan);

                showToast(`🤖 New AI ${mealType} generated!`);
            } catch (e) {
                console.warn('AI meal refresh failed; using local fallback:', e.message || e);
                // Fallback to local random selection
                const meals = mealDatabase[userDiet] || mealDatabase['Vegan'];
                if (currentMealPlan && meals[mealType]) {
                    const newMeal = meals[mealType][Math.floor(Math.random() * meals[mealType].length)];

                    if (mealType === 'snacks') {
                        currentMealPlan.snacks = [newMeal];
                    } else {
                        currentMealPlan[mealType] = newMeal;
                    }

                    // Recalculate totals
                    const breakfast = currentMealPlan.breakfast;
                    const lunch = currentMealPlan.lunch;
                    const dinner = currentMealPlan.dinner;
                    const snack = currentMealPlan.snacks[0];

                    currentMealPlan.totalCalories = breakfast.calories + lunch.calories + dinner.calories + snack.calories;
                    currentMealPlan.totalCarbs = breakfast.carbs + lunch.carbs + dinner.carbs + snack.carbs;
                    currentMealPlan.totalFat = breakfast.fat + lunch.fat + dinner.fat + snack.fat;
                    currentMealPlan.totalProtein = breakfast.protein + lunch.protein + dinner.protein + snack.protein;

                    displayDayMealPlan(currentMealPlan);
                    updateNutritionChart(currentMealPlan);

                    showToast(`${mealType.charAt(0).toUpperCase() + mealType.slice(1)} refreshed (local fallback)!`);
                }
            }
        }

        // Show messages
        function showSuccessMessage(message) {
            document.getElementById('statusMessage').innerHTML = `<div class="success-message">${message}</div>`;

            // Auto hide after 4 seconds
            setTimeout(() => {
                document.getElementById('statusMessage').innerHTML = '';
            }, 4000);
        }

        // Show toast notification
        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: #2c3e50;
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                font-size: 14px;
                z-index: 1000;
                animation: slideIn 0.3s ease;
            `;

            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    if (document.body.contains(toast)) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            @keyframes fadeOut {
                from { opacity: 1; }
                to { opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>

</html>